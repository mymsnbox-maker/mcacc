!function(){var e=new XMLHttpRequest,t=new XMLHttpRequest,a=new XMLHttpRequest,o=new XMLHttpRequest,r=[],n=0,s=0,l=0;"apps.pets.maricopa.gov"!=document.location.host&&window.open("http://apps.pets.maricopa.gov/adoptPets/Home","_blank");var i="East";switch(prompt("Location (defaults to "+i+"): e(ast), w(west), p(etsmart), a(ll)")){case"w":i="West";break;case"p":i="Petsmart";break;case"a":i="All"}var m=document.location.protocol+"//apps.pets.maricopa.gov/adoptPets/Home/AnimalGrid?sizeFilter=1&ageFilter=1&genderFilter=1&pageNumber=",d="&kennelNum=&env=https%3A%2F%2Fapps.pets.maricopa.gov%2FadoptPets&fosterEligible=false&animalTypeFilter=All&isLongTimer=false&isReadyToday=false&breedFilter=Any%20Breed&shelterFilter="+i,c=document.location.protocol+"//apps.pets.maricopa.gov/adoptPets/Home/Details/",p=document.location.protocol+"//apps.pets.maricopa.gov/SelfService/Home/AnimalInfo?AnimalId=";function g(e=!1){var t=!1;console.log("doSS: "+e+", li: "+n);for(let s=n;s<r.length;s++){for([aId,v]of r[s].others)if(console.log("value is: "+JSON.stringify(v)),!e&&null==v||e&&0===Object.keys(v).length){console.log("processOthers: Getting "+(e?"SS":"details")+" for "+aId),t=!0,n=s,e?(o.open("GET",p+aId,!0),o.send(null)):(a.open("GET",c+aId,!0),a.send(null));break}if(t)break}t||(e?(console.log("Completed all processing of others"),function(){var e=0;r.sort((function(e,t){return e.loc.localeCompare(t.loc,"en",{numeric:!0})})),console.log("showResults"),console.log(r);var t="<table border='1''>";dt=new Date;const a="{}",o="<a href='https://apps.pets.maricopa.gov/adoptPets/Home/Details/"+a+"' target='_blank'>"+a+"</a>";r.forEach((r=>{e++,smName=r.name.replace(" ","-").replace("'",""),t+="<tr><td>"+r.img+"</td><td>"+r.name+"</td><td>"+o.replaceAll(a,r.aId)+"</td><td style='max-width: 100px'>"+r.loc+"</td>",t+="<td><table border='1'>",r.others.forEach(((e,r)=>{t+="<tr><td>"+(e.adoptable?o.replaceAll(a,r):r)+"</td><td>"+e.name+"</td><td>"+e.stat+"</td></tr>"})),t+="</table></td>"})),tableStr="<figure>Intake Together ("+dt.toLocaleDateString()+" "+dt.toLocaleTimeString()+")<br>Location: "+i+"<br>Number of rows: "+e+"</figure>"+t+"</table>",document.open(),document.write(tableStr);var n=document.createElement("style");n.innerHTML="body {font-family:Arial} table {border-collapse:collapse} td {text-align:center;padding:10px;word-wrap:break-word} b {background-color:yellow}",document.head.appendChild(n),document.close()}()):(console.log("Processing SS for others"),console.log(r),n=0,g(!0)))}document.open(),document.write("Getting dogs from "+i+" ..."),e.open("GET",m+s+d,!0),e.send(null),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status&&e.responseText){var a=(new DOMParser).parseFromString(e.responseText,"text/html");[].forEach.call(a.getElementsByClassName("dogCard"),(function(e){aId=e.getElementsByTagName("a")[0].getAttribute("onClick").split("'")[1],name=e.querySelector(".searchPetTitleSpan").textContent.trim().toUpperCase(),imgStr=e.getElementsByTagName("img")[0].outerHTML,imgStr=imgStr.slice(0,4)+" style='max-width:200px'"+imgStr.slice(4),r[n++]={name:name,aId:aId,img:imgStr,others:new Map}})),l=a.getElementsByClassName("searchCountLabel")[0].innerText.trim().split(" ")[0],Math.floor(l/21)>s?(s++,e.open("GET",m+s+d,!0),e.send(null)):(document.write("<br>Getting details for each dog ..."),n=0,t.open("GET",c+r[n].aId,!0),t.send(null))}},t.onreadystatechange=function(){if(4==t.readyState&&200==t.status&&t.responseText){var e=(new DOMParser).parseFromString(t.responseText,"text/html");for(let t of e.body.getElementsByClassName("mb-0"))if(t.innerText.trim().toLowerCase().startsWith("location")){r[n].loc=t.getElementsByClassName("d-block")[0].innerText.trim();break}e:for(let t of e.body.getElementsByClassName("card-header"))if(t.innerText.trim().toLowerCase().startsWith("intake")){let e=t.parentElement.getElementsByClassName("card-body")[0].getElementsByTagName("span");for(let t of e){let e=t.innerText;if(null!=e.match(/together|came in with|found with/i))for(let t of e.split(/\s+/))res=t.match(/(A[0-9]{7})/i),null!=res&&res[1].toLowerCase()!=r[n].aId.toLowerCase()&&r[n].others.set(res[1],null)}break e}n<r.length-1?(document.write(">"),n++,t.open("GET",c+r[n].aId,!0),t.send(null)):(console.log("Before filtering"),console.log(r),r=r.filter((e=>e.others.size>0)),n=0,g())}},a.onreadystatechange=function(){if(4==a.readyState&&200==a.status&&a.responseText){var e=(new DOMParser).parseFromString(a.responseText,"text/html");let i=a.responseURL;var t=i.substring(i.lastIndexOf("/")+1),o="",s="",l={};if(e.body.innerText.includes("no longer available"))console.log("dog not available: "+t);else{console.log("dog available: "+t);for(let t of e.body.getElementsByClassName("mb-0"))t.innerText.trim().toLowerCase().startsWith("name")&&(o=t.getElementsByClassName("d-block")[0].innerText.trim()),t.innerText.trim().toLowerCase().startsWith("location")&&(s=t.getElementsByClassName("d-block")[0].innerText.trim());l={name:o,stat:s,adoptable:!0}}r[n].others.set(t,l),g()}},o.onreadystatechange=function(){if(4==o.readyState&&200==o.status&&o.responseText){var e=(new DOMParser).parseFromString(o.responseText,"text/html");let t=o.responseURL,a=t.substring(t.lastIndexOf("=")+1);card=e.getElementsByClassName("card")[0];let s="Not Available",l="Not Available";if(card){l=card.getElementsByTagName("span")[0].innerText.split("Status: ")[1];for(let e of card.getElementsByTagName("strong"))e.innerText.startsWith("Animal")&&(a=e.parentElement.innerText.split(": ")[1]),e.innerText.startsWith("Name")&&(s=e.parentElement.innerText.split(": ")[1])}else console.log("Not a valid aId in SS: "+a);r[n].others.set(a,{name:s,stat:l}),g(!0)}}}();

