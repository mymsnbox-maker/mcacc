!function(){var e=new XMLHttpRequest,t=new XMLHttpRequest,a=new XMLHttpRequest,n=new XMLHttpRequest,o=new XMLHttpRequest,r=new XMLHttpRequest,s=[],l=0,i=0,m=0,d=0;"apps.pets.maricopa.gov"!=document.location.host&&window.open("http://apps.pets.maricopa.gov/adoptPets/Home","_blank");var c="East";switch(prompt("Location (defaults to "+c+"): e(ast), w(west), p(etsmart), a(ll)")){case"w":c="West";break;case"p":c="Petsmart";break;case"a":c="All"}var p=document.location.protocol+"//apps.pets.maricopa.gov/adoptPets/Home/AnimalGrid?sizeFilter=1&ageFilter=1&genderFilter=1&pageNumber=",g="&kennelNum=&env=https%3A%2F%2Fapps.pets.maricopa.gov%2FadoptPets&fosterEligible=false&animalTypeFilter=All&isLongTimer=false&isReadyToday=false&breedFilter=Any%20Breed&shelterFilter="+c,u=document.location.protocol+"//apps.pets.maricopa.gov/adoptPets/Home/Details/",h=document.location.protocol+"//apps.pets.maricopa.gov/SelfService/Home/AnimalInfo?AnimalId=",f=document.location.protocol+"//apps.pets.maricopa.gov/priority/Home/AnimalGrid?submissionObj=%7B%22TypeChoice%22%3A%22ANY%22%2C%22SizeChoice%22%3A%22Any%20Size%22%2C%22BreedChoice%22%3A%22Any%20Breed%22%2C%22AgeChoice%22%3A%221%22%2C%22GenderChoice%22%3A%22Any%20Gender%22%2C%22ReasonChoice%22%3A%22Any%20Reason%22%2C%22AnimalName%22%3A%22Any%20Animal%22%2C%22AnimalId%22%3A%22Any%20ID%22%2C%22KennelNumber%22%3A%22Any%20Kennel%22%2C%22ShelterChoice%22%3A%22Both%20Shelters%22%7D&env=https%3A%2F%2Fapps.pets.maricopa.gov%2Fpriority%2F&pageNumber=",y=document.location.protocol+"//apps.pets.maricopa.gov";function b(e=!1){var t=!1;console.log("doSS: "+e+", li: "+l);for(let o=l;o<s.length;o++){for([aId,v]of s[o].others)if(console.log("value is: "+JSON.stringify(v)),!e&&null==v||e&&0===Object.keys(v).length){console.log("processOthers: Getting "+(e?"SS":"details")+" for "+aId),t=!0,l=o,document.write("."),e?(n.open("GET",h+aId,!0),n.send(null)):(a.open("GET",u+aId,!0),a.send(null));break}if(t)break}t||(e?(console.log("Completed all processing of others"),function(){var e=0;s.sort((function(e,t){return e.loc.localeCompare(t.loc,"en",{numeric:!0})})),console.log("showResults"),console.log(s);var t="<table border='1''>";dt=new Date;const a="{}",n="{}",o="<a href='https://apps.pets.maricopa.gov/adoptPets/Home/Details/"+a+"' target='_blank'>"+a+"</a>",r="<a href='https://apps.pets.maricopa.gov"+n+"' target='_blank'>"+a+"</a>";s.forEach((s=>{e++,smName=s.name.replace(" ","-").replace("'","");let l="<tr>";null!=s.lnk&&(l="<tr style='background-color:pink'>"),t+=l+"<td>"+s.img+"</td><td>"+s.name+"</td><td>"+(null==s.lnk?o.replaceAll(a,s.aId):r.replace(n,s.lnk).replace(a,s.aId))+"</td><td style='max-width: 100px'>"+s.loc+"</td>",t+="<td><table border='1'>",s.others.forEach(((e,n)=>{t+="<tr><td>"+(e.adoptable?o.replaceAll(a,n):n)+"</td><td>"+e.name+"</td><td>"+e.stat+"</td></tr>"})),t+="</table></td>"})),tableStr="<figure>Intake Together ("+dt.toLocaleDateString()+" "+dt.toLocaleTimeString()+")<br>Location: "+c+"<br>Number of rows: "+e+"</figure>"+t+"</table>",document.open(),document.write(tableStr);var l=document.createElement("style");l.innerHTML="body {font-family:Arial} table {border-collapse:collapse} td {text-align:center;padding:10px;word-wrap:break-word} b {background-color:yellow}",document.head.appendChild(l),document.close()}()):(console.log("Processing SS for others"),console.log(s),l=0,b(!0)))}document.open(),document.write("Getting dogs from "+c+" ..."),e.open("GET",p+m+g,!0),e.send(null),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status&&e.responseText){var a=(new DOMParser).parseFromString(e.responseText,"text/html");[].forEach.call(a.getElementsByClassName("dogCard"),(function(e){aId=e.getElementsByTagName("a")[0].getAttribute("onClick").split("'")[1],name=e.querySelector(".searchPetTitleSpan").textContent.trim().toUpperCase(),imgStr=e.getElementsByTagName("img")[0].outerHTML,imgStr=imgStr.slice(0,4)+" style='max-width:200px'"+imgStr.slice(4),s[l++]={name:name,aId:aId,img:imgStr,others:new Map}})),d=a.getElementsByClassName("searchCountLabel")[0].innerText.trim().split(" ")[0],Math.floor(d/21)>m?(m++,e.open("GET",p+m+g,!0),e.send(null)):(document.write("<br>Getting details for each dog ..."),l=0,t.open("GET",u+s[l].aId,!0),t.send(null))}},t.onreadystatechange=function(){if(4==t.readyState&&200==t.status&&t.responseText){var e=(new DOMParser).parseFromString(t.responseText,"text/html");for(let t of e.body.getElementsByClassName("mb-0"))if(t.innerText.trim().toLowerCase().startsWith("location")){s[l].loc=t.getElementsByClassName("d-block")[0].innerText.trim();break}e:for(let t of e.body.getElementsByClassName("card-header"))if(t.innerText.trim().toLowerCase().startsWith("intake")){let e=t.parentElement.getElementsByClassName("card-body")[0].getElementsByTagName("span");for(let t of e){let e=t.innerText;if(null!=e.match(/together|came in with|found with/i))for(let t of e.split(/\s+/))res=t.match(/(A[0-9]{7})/i),null!=res&&res[1].toLowerCase()!=s[l].aId.toLowerCase()&&s[l].others.set(res[1],null)}break e}l<s.length-1?(document.write(">"),l++,t.open("GET",u+s[l].aId,!0),t.send(null)):(console.log("After Adoptables"),console.log(s),m=1,i=l,console.log("Priority index is "+i),document.write("<br>Getting Priority page "+m),o.open("GET",f+m,!0),o.send(null))}},o.onreadystatechange=function(){if(4==o.readyState&&200==o.status&&o.responseText){var e=(new DOMParser).parseFromString(o.responseText,"text/html");[].forEach.call(e.getElementsByClassName("dogCard"),(function(e){anchs=e.getElementsByTagName("a"),lnk=anchs[0].getAttribute("href"),titleSpans=anchs[0].getElementsByTagName("span"),aId=titleSpans[0].innerText.trim(),name=titleSpans[1].innerText.trim(),detailSpans=e.getElementsByClassName("searchPetInfoAgeSex"),loc=detailSpans[2].innerText.trim(),imgG=e.getElementsByClassName("img-gradient")[0],img=imgG.outerHTML.replace(/<img /,"<img style='max-width:200px' "),aStatus=imgG.getElementsByTagName("p"),saved="",aStatus.length>0&&(saved=aStatus[0].innerText.trim()),s[l++]={name:name,aId:aId,img:img,loc:loc,lnk:lnk,aStatus:aStatus,saved:saved,others:new Map}})),nextBtn=!1,navBtns=e.querySelectorAll("button.btn-secondary");for(let e=0;e<navBtns.length;e++)if("next"==navBtns[e].innerText.toLowerCase().trim()){nextBtn=!0;break}nextBtn?(m++,document.write("<br>Getting Priority page "+m),o.open("GET",f+m,!0),o.send(null)):(document.write("<br>Getting Priority dog details..."),console.log("Getting priority details"),console.log(s),l=i,r.open("GET",y+s[l].lnk,!0),r.send(null))}},r.onreadystatechange=function(){if(4==r.readyState&&200==r.status&&r.responseText){var e=(new DOMParser).parseFromString(r.responseText,"text/html");e:for(let t of e.body.getElementsByClassName("card-header"))if(t.innerText.trim().toLowerCase().startsWith("intake")){let e=t.parentElement.getElementsByClassName("card-body")[0].getElementsByTagName("p");for(let t of e){let e=t.innerText;if(null!=e.match(/together|came in with|found with/i)){console.log("Found intake together entry in priority");for(let t of e.split(/\s+/))res=t.match(/(A[0-9]{7})/i),null!=res&&res[1].toLowerCase()!=s[l].aId.toLowerCase()&&s[l].others.set(res[1],null)}}break e}l<s.length-1?(l++,document.write("<"),r.open("GET",y+s[l].lnk,!0),r.send(null)):(document.write("<br>Processing gathered data"),console.log("Processing others"),console.log("List before filter"),console.log(s),console.log("List after filtering for others > 0"),s=s.filter((e=>e.others.size>0)),console.log(s),l=0,b())}},a.onreadystatechange=function(){if(4==a.readyState&&200==a.status&&a.responseText){var e=(new DOMParser).parseFromString(a.responseText,"text/html");let i=a.responseURL;var t=i.substring(i.lastIndexOf("/")+1),n="",o="",r={};if(e.body.innerText.includes("no longer available"))console.log("dog not available: "+t);else{console.log("dog available: "+t);for(let t of e.body.getElementsByClassName("mb-0"))t.innerText.trim().toLowerCase().startsWith("name")&&(n=t.getElementsByClassName("d-block")[0].innerText.trim()),t.innerText.trim().toLowerCase().startsWith("location")&&(o=t.getElementsByClassName("d-block")[0].innerText.trim());r={name:n,stat:o,adoptable:!0}}s[l].others.set(t,r),b()}},n.onreadystatechange=function(){if(4==n.readyState&&200==n.status&&n.responseText){var e=(new DOMParser).parseFromString(n.responseText,"text/html");let t=n.responseURL,a=t.substring(t.lastIndexOf("=")+1);card=e.getElementsByClassName("card")[0];let o="Not Available",r="Not Available";if(card){r=card.getElementsByTagName("span")[0].innerText.split("Status: ")[1];for(let e of card.getElementsByTagName("strong"))e.innerText.startsWith("Animal")&&(a=e.parentElement.innerText.split(": ")[1]),e.innerText.startsWith("Name")&&(o=e.parentElement.innerText.split(": ")[1])}else console.log("Not a valid aId in SS: "+a);s[l].others.set(a,{name:o,stat:r}),b(!0)}}}();
