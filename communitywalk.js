!function(){var e=new XMLHttpRequest,t=new XMLHttpRequest,o=[],a=0,r=0,n=0;if("apps.pets.maricopa.gov"!=document.location.host)return window.open("http://apps.pets.maricopa.gov/adoptPets/Home","_blank"),!1;var l="East",i="Hope Whispers";if("f"===prompt("Select community walk type:\nHope Whispers (h, default)\nFour Paws (f)"))i="Four Paws",l="West";var s=confirm("Press Ok to show only eligible dogs, Cancel to show all dogs"),c="//apps.pets.maricopa.gov/adoptPets/Home/AnimalGrid?sizeFilter=1&ageFilter=1&genderFilter=1&kennelNum=&env=https%3A%2F%2Fapps.pets.maricopa.gov%2FadoptPets&fosterEligible=false&animalTypeFilter=All&isLongTimer=false&isReadyToday=false&breedFilter=Any%20Breed&pageNumber=",d="&animalId=&shelterFilter=";document.open(),document.write("Community Walk Dogs<br>Getting dogs for "+i+" "),e.open("GET",document.location.protocol+c+r+d+l,!0),e.send(null),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status&&e.responseText){var i=(new DOMParser).parseFromString(e.responseText,"text/html");[].forEach.call(i.getElementsByClassName("dogCard"),(function(e){aId=e.getElementsByTagName("a")[0].getAttribute("onClick").split("'")[1],name=e.querySelector(".searchPetTitleSpan").textContent.trim().toUpperCase(),imgStr=e.getElementsByTagName("img")[0].outerHTML,imgStr=imgStr.slice(0,4)+" style='max-width:200px;max-height:200px'"+imgStr.slice(4),o[a++]={name:name,aId:aId,img:imgStr}})),n=i.getElementsByClassName("searchCountLabel")[0].innerText.trim().split(" ")[0],Math.floor(n/21)>r?(document.write("."),r++,e.open("GET",document.location.protocol+c+r+d+l,!0),e.send(null)):(document.write("<br>Getting details "),a=0,t.open("GET",document.location.protocol+"//apps.pets.maricopa.gov/adoptPets/Home/Details/"+o[a].aId,!0),t.send(null))}},t.onreadystatechange=function(){if(4==t.readyState&&200==t.status&&t.responseText){new Date;var e,r=(new DOMParser).parseFromString(t.responseText,"text/html"),n="",c="",d="",p=!1,g="",u="",y=!1,f=!1,b=!1;for(let t of r.body.getElementsByClassName("mb-0")){if(t.innerText.trim().toLowerCase().startsWith("location")){locF=t.getElementsByClassName("d-block")[0].innerText.trim().split(" ");let e=locF[0],o=locF[locF.length-3],a=locF[locF.length-1];switch(e.toLowerCase()){case"east":"C"==o&&Number(a)>247?y=!0:("Q"==o||"S"==o&&Number(a)>=206)&&(f=!0);break;case"west":"H"==o||"I"==o?y=!0:"Q"!=o&&"S"!=o||(f=!0);break;default:b=!0}c=e+" "+o+a}t.innerText.trim().toLowerCase().startsWith("level")&&(n=t.getElementsByClassName("d-block")[0].innerText.trim()),t.innerText.trim().toLowerCase().startsWith("age")&&(e=!1,(u=t.getElementsByClassName("d-block")[0].innerText.trim()).includes("year")||(u.includes("month")?(m=u.split("month")[0].trim(),m<6&&(e=!0)):u.includes("week")&&(m=u.split("week")[0].trim(),m<=16&&(e=!0)))),t.innerText.trim().toLowerCase().startsWith("adoption")&&(d=t.getElementsByClassName("d-block")[0].innerText.trim())}for(let e of r.body.getElementsByClassName("card-header"))if(e.innerText.trim().toLowerCase().startsWith("medical")){let t=e.parentElement.getElementsByClassName("card-body")[0].getElementsByTagName("td");for(let e of t){let t=e.innerText.toLowerCase(),r=new Date(t.trim().split("\n")[0]),n=/move out of|no further treatment|no treatment|no active cirdc|discontinue doxy|discontinue med/;if(n.test(t)){console.log(o[a].aId+" "+o[a].name+": cleared on "+r),p=!1;break}if(n=/doxy/,n.test(t)){console.log("Doxy term found: "+t),p=!0;let e=new Date(t.trim().split("\n")[0]),r=new Date,n=18,l=new Date(e);r>l.setDate(l.getDate()+Number(n))&&(console.log(o[a].aId+" "+o[a].name+": Doxy date "+e.toLocaleDateString()+" too old - removing dog as sick"),p=!1,g=e);break}}}if(o[a].loc=c,o[a].eligRestricted=f,o[a].ignore=b,o[a].level=n,o[a].age=u,o[a].isPuppy=e,o[a].fee=d,o[a].isSick=p,o[a].oldDoxyDate=g,o[a].sickWing=y,a<o.length-1)document.write(">"),a++,t.open("GET",document.location.protocol+"//apps.pets.maricopa.gov/adoptPets/Home/Details/"+o[a].aId,!0),t.send(null);else{console.log(o),document.open(),o.sort(((e,t)=>e.loc.localeCompare(t.loc,"en",{numeric:!0})));let e=new Date,t=[],a="";"West"==l?(a="<br>Sick Wing: H & I; Restricted Wing: S",s?o=o.filter((e=>"G"==e.level&&0==e.ignore&&0==e.isPuppy&&0==e.eligRestricted&&0==e.sickWing)):t=o.filter((e=>"G"==e.level&&0==e.ignore&&0==e.isPuppy&&0==e.eligRestricted&&0==e.sickWing))):(a="<br>Sick Wing: C248-C283; Restricted Kennels: S206+",s?o=o.filter((e=>"G"==e.level&&0==e.ignore&&0==e.isPuppy&&0==e.isSick&&0==e.sickWing)):t=o.filter((e=>"G"==e.level&&0==e.ignore&&0==e.isPuppy&&0==e.isSick&&0==e.sickWing)));let r=o.length;var h="<p>"+i+" Report Time: "+e.toLocaleDateString()+" "+e.toLocaleTimeString()+"<br>TOTAL ROWS: "+r+a+"</p>";h+="<table border='1' style='border-collapse:collapse'>",o.forEach((e=>{e.name.replace(" ","-").replace("'","").toLowerCase();let o="",a="<tr>";e.oldDoxyDate&&(o="Double Check - old doxy date ("+e.oldDoxyDate.toLocaleDateString()+") & missing vet clearance note",a="<tr style='background-color:lightgreen'>"),e.isSick&&(o="SICK",a="<tr style='background-color:lightblue'>"),e.eligRestricted&&(o+="RESTRICTED KENNEL - Staff access needed",a="<tr style='background-color:pink'>"),s||null!=t.find((t=>t.aId==e.aId))||(a="<tr style='background-color:lightgray;text-decoration:line-through;color: rgba(0,0,0,0.3)'>"),h+=a+"<td>"+e.img+"</td><td>"+e.name+"<br><br><a href='https://apps.pets.maricopa.gov/adoptPets/Home/Details/"+e.aId+"' target='_blank'>"+e.aId+"</a></td><td>"+e.loc+"<br><br>Level: "+e.level+"<br><br>"+e.age+"</td><td>"+o+"</td></tr>"})),h+="</table><figure>TOTAL ROWS: "+r+"</figure>",document.write(h);var T=document.createElement("style");T.innerHTML="body {font-family:Arial} td {text-align:center; padding:10px; font-size:1.5em}",document.head.appendChild(T)}}}}();
